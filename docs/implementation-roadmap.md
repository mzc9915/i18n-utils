# i18n å·¥å…·é“¾å®æ–½è·¯çº¿å›¾

## æ–‡æ¡£å¯¼èˆª

æœ¬æ–¹æ¡ˆç”±ä»¥ä¸‹æ–‡æ¡£ç»„æˆ:

1. **i18n-solution-design.md** - å›½é™…åŒ–è§£å†³æ–¹æ¡ˆè®¾è®¡ (æ ¸å¿ƒè®¾è®¡ç†å¿µ)
2. **ast-scene-analysis.md** - AST åœºæ™¯åˆ†æ (æŠ€æœ¯å¯è¡Œæ€§åˆ†æ) â­ NEW
3. **toolchain-architecture.md** - å·¥å…·é“¾æ¶æ„è®¾è®¡ (è¯¦ç»†æŠ€æœ¯è®¾è®¡) â­ NEW
4. **implementation-roadmap.md** - å®æ–½è·¯çº¿å›¾ (æœ¬æ–‡æ¡£) â­ NEW

---

## ä¸€ã€æ–¹æ¡ˆæ€»è§ˆ

### 1.1 æ ¸å¿ƒç›®æ ‡

åœ¨è¿è¡Œå¤šå¹´çš„é¡¹ç›®ä¸­è½åœ°å›½é™…åŒ–,å®ç°:
- âœ… è‡ªåŠ¨æå–ä»£ç ä¸­çš„ä¸­æ–‡æ–‡æœ¬
- âœ… ç”Ÿæˆè¯­ä¹‰åŒ–çš„ key å‘½å
- âœ… è‡ªåŠ¨æˆ–åŠè‡ªåŠ¨æ›¿æ¢ä¸º i18n è°ƒç”¨
- âœ… å»ºç«‹å¯ç»´æŠ¤çš„ç¿»è¯‘æ–‡ä»¶ä½“ç³»
- âœ… æä¾›å®Œæ•´çš„å·¥å…·é“¾æ”¯æŒ

### 1.2 æ–¹æ¡ˆç‰¹ç‚¹

| ç‰¹ç‚¹ | è¯´æ˜ |
|-----|------|
| **è¯­ä¹‰åŒ– Key** | ä» `zccsau6` æ”¹ä¸º `common.buttons.btn_submit` |
| **Key èšåˆ** | æ¯ä¸ª key ä¸‹ç»´æŠ¤æ‰€æœ‰è¯­è¨€,ä¾¿äºå¯¹æ¯” |
| **æ¨¡å—åŒ–ç®¡ç†** | æŒ‰ä¸šåŠ¡æ¨¡å—åˆ’åˆ†æ–‡ä»¶,æ¸…æ™°å¯ç»´æŠ¤ |
| **AST å¢å¼º** | æ”¶é›†ä¸°å¯Œä¸Šä¸‹æ–‡,æ™ºèƒ½æ¨æ–­ç±»å‹å’Œæ¨¡å— |
| **åˆ†ç±»å¤„ç†** | è‡ªåŠ¨/å®¡æ ¸/æ‰‹åŠ¨ä¸‰çº§åˆ†ç±»,æé«˜æ•ˆç‡ |
| **æ ‡è®°ç³»ç»Ÿ** | æ”¯æŒæ³¨é‡Šæ ‡è®°,å¤„ç†ç‰¹æ®Šåœºæ™¯ |

### 1.3 æŠ€æœ¯è¾¹ç•Œ

**AST èƒ½å¤Ÿå¤„ç†çš„åœºæ™¯** âœ…:
- JSX æ–‡æœ¬èŠ‚ç‚¹: `<div>ä½ å¥½</div>`
- å­—ç¬¦ä¸²å­—é¢é‡: `const title = "äº§å“åˆ—è¡¨"`
- JSX å±æ€§å€¼: `<input placeholder="è¯·è¾“å…¥" />`
- ç®€å•æ¨¡æ¿å­—ç¬¦ä¸²: `` const msg = `æ¬¢è¿` ``
- å¯¹è±¡å’Œæ•°ç»„: `{ title: "æ ‡é¢˜" }`, `["é€‰é¡¹1", "é€‰é¡¹2"]`

**éœ€è¦äººå·¥å®¡æ ¸çš„åœºæ™¯** âš ï¸:
- å¤æ‚æ¨¡æ¿å­—ç¬¦ä¸² (åŒ…å« HTML)
- åŠ¨æ€æ‹¼æ¥çš„å­—ç¬¦ä¸²
- é•¿æ–‡æœ¬å†…å®¹ (>50 å­—ç¬¦)
- æ¡ä»¶è¡¨è¾¾å¼ä¸­çš„æ–‡æœ¬

**åº”æ’é™¤çš„åœºæ™¯** âŒ:
- æ­£åˆ™è¡¨è¾¾å¼: `/ç”¨æˆ·å/`
- SQL è¯­å¥: `"SELECT * FROM äº§å“è¡¨"`
- CSS é€‰æ‹©å™¨: `"[data-title='äº§å“']"`
- æ³¨é‡Š

---

## äºŒã€å·¥å…·é“¾æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      i18n å·¥å…·é“¾                             â”‚
â”‚                                                              â”‚
â”‚  æå– â†’ å®¡æ ¸ â†’ åº”ç”¨ â†’ ç¿»è¯‘ â†’ åŒæ­¥ â†’ æ£€æŸ¥ â†’ æ„å»º            â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚  extract  â”‚â”€â”€>â”‚  review   â”‚â”€â”€>â”‚   apply   â”‚            â”‚
â”‚  â”‚ ä»£ç æå–  â”‚   â”‚ äººå·¥å®¡æ ¸  â”‚   â”‚ ä»£ç æ›¿æ¢  â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚       â”‚                                  â”‚                  â”‚
â”‚       v                                  v                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚          å¾…ç¿»è¯‘æ¸…å• + æ›´æ–°åçš„ä»£ç             â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚       â”‚                                                     â”‚
â”‚       v                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚   sync    â”‚   â”‚   check   â”‚   â”‚   build   â”‚            â”‚
â”‚  â”‚  åŒæ­¥key  â”‚   â”‚ ä¸€è‡´æ€§æ£€æŸ¥â”‚   â”‚ æ„å»ºåˆå¹¶  â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                          â”‚                  â”‚
â”‚                                          v                  â”‚
â”‚                                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚                                  â”‚æŒ‰è¯­è¨€åˆ†ç»„JSONâ”‚          â”‚
â”‚                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒå·¥å…·

1. **i18n-extract** - æå– + è¯­ä¹‰åŒ–å‘½å (æœ€æ ¸å¿ƒ)
2. **i18n-review** - äº¤äº’å¼å®¡æ ¸ (å¯é€‰)
3. **i18n-apply** - ä»£ç æ›¿æ¢ (æ ¸å¿ƒ)
4. **i18n-sync** - åŒæ­¥ key ç»“æ„
5. **i18n-check** - ä¸€è‡´æ€§æ£€æŸ¥
6. **i18n-build** - æ„å»ºæ—¶åˆå¹¶

---

## ä¸‰ã€å®æ–½è®¡åˆ’

### é˜¶æ®µ 0: å‡†å¤‡å·¥ä½œ (1 å‘¨)

**ç›®æ ‡**: æ˜ç¡®æŠ€æœ¯æ–¹æ¡ˆ,æ­å»ºé¡¹ç›®æ¡†æ¶

#### ä»»åŠ¡æ¸…å•:
- [x] å®Œæˆæ–¹æ¡ˆè®¾è®¡æ–‡æ¡£
- [x] å®Œæˆ AST åœºæ™¯åˆ†æ
- [x] å®Œæˆå·¥å…·é“¾æ¶æ„è®¾è®¡
- [ ] æ­å»º monorepo é¡¹ç›®ç»“æ„
- [ ] é…ç½® TypeScript + Rollup
- [ ] æ­å»ºæµ‹è¯•ç¯å¢ƒ

#### é¡¹ç›®ç»“æ„:
```
packages/
â”œâ”€â”€ i18n-core/          # å…±äº«æ ¸å¿ƒ
â”‚   â”œâ”€â”€ config/         # é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ utils/          # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ types/          # ç±»å‹å®šä¹‰
â”‚   â””â”€â”€ constants/      # å¸¸é‡
â”‚
â”œâ”€â”€ i18n-extract/       # æå–å·¥å…· â­ ä¼˜å…ˆ
â”œâ”€â”€ i18n-apply/         # æ›¿æ¢å·¥å…· â­ ä¼˜å…ˆ
â”œâ”€â”€ i18n-build/         # æ„å»ºå·¥å…· â­ ä¼˜å…ˆ
â”œâ”€â”€ i18n-check/         # æ£€æŸ¥å·¥å…·
â”œâ”€â”€ i18n-sync/          # åŒæ­¥å·¥å…·
â”œâ”€â”€ i18n-review/        # å®¡æ ¸å·¥å…· (åæœŸ)
â”‚
â””â”€â”€ i18n-cli/           # ç»Ÿä¸€ CLI
```

#### æŠ€æœ¯æ ˆ:
```json
{
  "dependencies": {
    "@babel/parser": "^7.x",
    "@babel/traverse": "^7.x",
    "@babel/types": "^7.x",
    "@babel/generator": "^7.x",
    "fs-extra": "^11.x",
    "glob": "^10.x",
    "chalk": "^5.x",
    "ora": "^6.x",
    "commander": "^11.x",
    "inquirer": "^9.x",
    "cosmiconfig": "^8.x",
    "pinyin": "^3.x"
  },
  "devDependencies": {
    "typescript": "^5.x",
    "rollup": "^4.x",
    "@types/node": "^20.x",
    "vitest": "^1.x"
  }
}
```

---

### é˜¶æ®µ 1: i18n-extract (æ ¸å¿ƒ) (2 å‘¨)

**ç›®æ ‡**: å®ç°ä»£ç æ‰«æã€ä¸Šä¸‹æ–‡åˆ†æã€key ç”Ÿæˆ

#### Week 1: åŸºç¡€åŠŸèƒ½

**Day 1-2: æ‰«æå™¨ (Scanner)**
```typescript
// åŠŸèƒ½:
// - æ–‡ä»¶æ‰«æ (glob)
// - AST è§£æ (@babel/parser)
// - ä¸Šä¸‹æ–‡æ”¶é›†

class Scanner {
  scan(files: string[]): ExtractedText[]
  parseFile(file: string): ExtractedText[]
  collectContext(node: Node): Context
}

// æµ‹è¯•:
// - æ‰«æ React/Vue æ–‡ä»¶
// - æå– JSX æ–‡æœ¬ã€å­—ç¬¦ä¸²å­—é¢é‡
// - æ”¶é›†çˆ¶å…ƒç´ ã€å˜é‡åç­‰ä¸Šä¸‹æ–‡
```

**Day 3-4: ä¸Šä¸‹æ–‡åˆ†æå™¨ (ContextAnalyzer)**
```typescript
// åŠŸèƒ½:
// - ç±»å‹æ¨æ–­ (button, error, placeholder)
// - æ¨¡å—æ¨æ–­ (ä»æ–‡ä»¶è·¯å¾„ã€ä½œç”¨åŸŸé“¾)

class ContextAnalyzer {
  inferType(extracted: ExtractedText): TextType
  inferModule(extracted: ExtractedText): string
}

// æµ‹è¯•:
// - è¯†åˆ«æŒ‰é’®æ–‡æœ¬ â†’ button
// - è¯†åˆ« placeholder å±æ€§ â†’ placeholder
// - ä»æ–‡ä»¶è·¯å¾„æ¨æ–­æ¨¡å— â†’ drama.list
```

**Day 5: æ ‡è®°è§£æå™¨ (MarkerParser)**
```typescript
// åŠŸèƒ½:
// - è§£ææ³¨é‡Šæ ‡è®°
// - æ”¯æŒ @i18n-ignore, @i18n-key ç­‰

class MarkerParser {
  parse(code: string, line: number): Markers
}

// æµ‹è¯•:
// - è¯†åˆ« @i18n-ignore
// - è¯†åˆ« @i18n-key: custom.key
```

#### Week 2: Key ç”Ÿæˆä¸è¾“å‡º

**Day 1-3: Key ç”Ÿæˆå™¨ (KeyGenerator)**
```typescript
// åŠŸèƒ½:
// - å¸¸ç”¨è¯æ˜ å°„ (æäº¤ â†’ submit)
// - è¯­ä¹‰åŒ–å‘½å (ä¸­æ–‡è½¬æ‹¼éŸ³)
// - Hash é™çº§
// - å†²çªè§£å†³

class KeyGenerator {
  generate(extracted: ExtractedText): string
  generateSemanticKey(): string
  generateHashKey(): string
  resolveConflict(key: string): string
}

// æµ‹è¯•:
// - "æäº¤" â†’ "btn_submit"
// - "ç”¨æˆ·ç™»å½•é¡µé¢" â†’ "user_login_page"
// - é•¿æ–‡æœ¬ â†’ "text_a7f9e2c1" (hash)
```

**Day 4: åˆ†ç±»å™¨ (Classifier)**
```typescript
// åŠŸèƒ½:
// - æ ¹æ®å¤æ‚åº¦åˆ†ç±» (auto/review/manual)
// - è®¡ç®—å¤æ‚åº¦è¯„åˆ†

class Classifier {
  classify(items: AnalyzedItem[]): ClassifiedResult
  calculateComplexity(item: AnalyzedItem): number
}

// æµ‹è¯•:
// - ç®€å•æ–‡æœ¬ â†’ auto
// - é•¿æ–‡æœ¬ â†’ review
// - æ ‡è®° @i18n-manual â†’ manual
```

**Day 5: è¾“å‡ºå™¨ (OutputGenerator)**
```typescript
// åŠŸèƒ½:
// - ç”Ÿæˆæå–æ¸…å• (extract-manifest.json)
// - ç”Ÿæˆå¾…ç¿»è¯‘æ–‡ä»¶ (pending-translations.json)
// - ç”Ÿæˆå®¡æ ¸æŠ¥å‘Š (review-report.md)

class OutputGenerator {
  generateManifest(result: ClassifiedResult): void
  generatePendingTranslations(result: ClassifiedResult): void
  generateReport(result: ClassifiedResult): void
}

// æµ‹è¯•:
// - JSON æ ¼å¼æ­£ç¡®
// - Markdown æŠ¥å‘Šæ¸…æ™°
```

#### äº¤ä»˜ç‰©:
- âœ… å¯è¿è¡Œçš„ `i18n-extract` å‘½ä»¤
- âœ… è¾“å‡º JSON æ¸…å•å’ŒæŠ¥å‘Š
- âœ… å•å…ƒæµ‹è¯•è¦†ç›–ç‡ >80%

#### ç¤ºä¾‹ç”¨æ³•:
```bash
npm run i18n:extract

# è¾“å‡º:
# âœ“ æ‰«æäº† 45 ä¸ªæ–‡ä»¶
# âœ“ æå–äº† 234 ä¸ªæ–‡æœ¬
# âœ“ è‡ªåŠ¨å¤„ç†: 156 (66.7%)
# âœ“ éœ€è¦å®¡æ ¸: 23 (9.8%)
# âœ“ æ‰‹åŠ¨æ ‡è®°: 12 (5.1%)
# âœ“ å¿½ç•¥é¡¹: 43 (18.4%)
#
# ğŸ“„ extract-manifest.json
# ğŸ“„ pending-translations.json
# ğŸ“„ review-report.md
```

---

### é˜¶æ®µ 2: i18n-apply (ä»£ç æ›¿æ¢) (1 å‘¨)

**ç›®æ ‡**: å°†æå–çš„ä¸­æ–‡æ›¿æ¢ä¸º `t()` è°ƒç”¨

#### Week 3: æ›¿æ¢é€»è¾‘

**Day 1-2: æ›¿æ¢å™¨ (Replacer)**
```typescript
// åŠŸèƒ½:
// - AST æ›¿æ¢
// - ç”Ÿæˆ t() è°ƒç”¨
// - ä¿æŒä»£ç æ ¼å¼

class Replacer {
  replaceInFile(file: string, items: ApplyItem[]): string
  generateReplacement(item: ApplyItem): Node
}

// æµ‹è¯•:
// - <div>æäº¤</div> â†’ <div>{t('common.buttons.btn_submit')}</div>
// - const x = "æ ‡é¢˜" â†’ const x = t('drama.list.title')
```

**Day 3: å¤‡ä»½ç®¡ç† (BackupManager)**
```typescript
// åŠŸèƒ½:
// - å¤‡ä»½åŸæ–‡ä»¶
// - æ”¯æŒæ’¤é”€

class BackupManager {
  backup(file: string): void
  restore(file: string): void
  undo(): void
}
```

**Day 4: Diff ç”Ÿæˆ (DiffGenerator)**
```typescript
// åŠŸèƒ½:
// - ç”Ÿæˆ diff
// - å½©è‰²ç»ˆç«¯è¾“å‡º

class DiffGenerator {
  generate(original: string, modified: string): string
  display(diff: string): void
}
```

**Day 5: é›†æˆæµ‹è¯•**
- å®Œæ•´æµç¨‹æµ‹è¯•
- è¾¹ç•Œæƒ…å†µæµ‹è¯•
- æ€§èƒ½æµ‹è¯•

#### äº¤ä»˜ç‰©:
- âœ… å¯è¿è¡Œçš„ `i18n-apply` å‘½ä»¤
- âœ… æ”¯æŒå¤‡ä»½å’Œæ’¤é”€
- âœ… ç”Ÿæˆ diff

#### ç¤ºä¾‹ç”¨æ³•:
```bash
npm run i18n:apply

# è¾“å‡º:
# âœ“ å¤„ç†äº† 15 ä¸ªæ–‡ä»¶
# âœ“ æ›¿æ¢äº† 156 å¤„æ–‡æœ¬
# âœ“ ç”Ÿæˆäº†å¤‡ä»½: backup/
# âœ“ ç”Ÿæˆäº† diff: apply-diff.patch
#
# æŸ¥çœ‹å˜æ›´:
# git diff
```

---

### é˜¶æ®µ 3: i18n-build (æ„å»ºå·¥å…·) (3 å¤©)

**ç›®æ ‡**: æ„å»ºæ—¶å°†æ¨¡å—åŒ–æ–‡ä»¶åˆå¹¶ä¸ºæŒ‰è¯­è¨€åˆ†ç»„

#### Day 1-2: æ„å»ºå™¨

```typescript
class I18nBuilder {
  build(): void
  extractTranslations(files: string[]): Translation[]
  groupByLanguage(translations: Translation[]): Record<string, any>
  flatten(nested: Record<string, any>): Record<string, string>
}

// æµ‹è¯•:
// - æ‰«æ src/locales/**/*.ts
// - ç”Ÿæˆ dist/locales/zh-CN.json
// - æ”¯æŒæ‰å¹³åŒ–å’ŒåµŒå¥—ä¸¤ç§æ ¼å¼
```

#### Day 3: é›†æˆæµ‹è¯•

#### äº¤ä»˜ç‰©:
- âœ… å¯è¿è¡Œçš„ `i18n-build` å‘½ä»¤
- âœ… è¾“å‡ºæŒ‰è¯­è¨€åˆ†ç»„çš„ JSON

#### ç¤ºä¾‹ç”¨æ³•:
```bash
npm run i18n:build

# è¾“å‡º:
# âœ“ æ‰«æäº† src/locales/
# âœ“ ç”Ÿæˆäº† dist/locales/zh-CN.json
# âœ“ ç”Ÿæˆäº† dist/locales/en-US.json
# âœ“ ç”Ÿæˆäº† dist/locales/ja-JP.json
```

---

### é˜¶æ®µ 4: i18n-check + i18n-sync (1 å‘¨)

**ç›®æ ‡**: è´¨é‡ä¿è¯å’Œç»´æŠ¤å·¥å…·

#### Day 1-3: i18n-check (æ£€æŸ¥å·¥å…·)

```typescript
class I18nChecker {
  check(): CheckResult
  checkKeyCompleteness(): Issue[]
  checkTranslationContent(): Issue[]
  checkInterpolationVars(): Issue[]
  checkCodeReferences(): Issue[]
}

// æ£€æŸ¥é¡¹:
// - Key å®Œæ•´æ€§ (æ‰€æœ‰è¯­è¨€éƒ½æœ‰)
// - ç¿»è¯‘å†…å®¹éç©º
// - æ’å€¼å˜é‡ä¸€è‡´
// - ä»£ç å¼•ç”¨æœ‰æ•ˆ
```

#### Day 4-5: i18n-sync (åŒæ­¥å·¥å…·)

```typescript
class I18nSyncer {
  sync(): void
  detectIssues(): SyncIssue[]
  autoFix(issues: SyncIssue[]): FixResult[]
}

// åŠŸèƒ½:
// - æ£€æµ‹ç¼ºå¤±çš„è¯­è¨€
// - è‡ªåŠ¨æ·»åŠ  TODO
// - ç§»é™¤åºŸå¼ƒ key
```

#### äº¤ä»˜ç‰©:
- âœ… `i18n-check` å‘½ä»¤
- âœ… `i18n-sync` å‘½ä»¤
- âœ… CI å‹å¥½ (é€€å‡ºç )

---

### é˜¶æ®µ 5: i18n-cli (ç»Ÿä¸€å…¥å£) (2 å¤©)

**ç›®æ ‡**: ç»Ÿä¸€å‘½ä»¤è¡Œæ¥å£

```typescript
// i18n-cli/src/index.ts
import { program } from 'commander';

program
  .name('i18n')
  .description('i18n å·¥å…·é“¾')
  .version('1.0.0');

program
  .command('extract')
  .description('æå–ä»£ç ä¸­çš„æ–‡æœ¬')
  .option('-c, --config <path>', 'é…ç½®æ–‡ä»¶')
  .action(extractCommand);

program
  .command('apply')
  .description('åº”ç”¨æ›¿æ¢')
  .option('--mode <mode>', 'æ¨¡å¼: auto|all')
  .action(applyCommand);

program
  .command('build')
  .description('æ„å»ºè¯­è¨€åŒ…')
  .option('--output <dir>', 'è¾“å‡ºç›®å½•')
  .action(buildCommand);

// ...

program.parse();
```

#### äº¤ä»˜ç‰©:
- âœ… ç»Ÿä¸€çš„ `i18n` å‘½ä»¤
- âœ… å®Œæ•´çš„å¸®åŠ©æ–‡æ¡£
- âœ… é…ç½®æ–‡ä»¶æ”¯æŒ

#### ä½¿ç”¨ç¤ºä¾‹:
```bash
i18n extract --config=./i18n.config.ts
i18n apply --mode=auto
i18n build --output=./dist/locales
i18n check --ci
i18n sync
```

---

### é˜¶æ®µ 6: å®Œå–„å’Œä¼˜åŒ– (1 å‘¨)

#### Day 1-2: i18n-review (äº¤äº’å¼å®¡æ ¸)

```typescript
// ä½¿ç”¨ inquirer å®ç°äº¤äº’å¼å®¡æ ¸
import inquirer from 'inquirer';

class I18nReviewer {
  async review(): Promise<void> {
    const items = await this.loadReviewItems();
    
    for (const item of items) {
      const answer = await inquirer.prompt([
        {
          type: 'list',
          name: 'action',
          message: `å¦‚ä½•å¤„ç† "${item.text}"?`,
          choices: [
            'æ¥å—å»ºè®® key',
            'è‡ªå®šä¹‰ key',
            'æ ‡è®°ä¸ºæ‰‹åŠ¨å¤„ç†',
            'å¿½ç•¥',
            'è·³è¿‡'
          ]
        }
      ]);
      
      // å¤„ç†ç”¨æˆ·é€‰æ‹©...
    }
  }
}
```

#### Day 3-4: æ€§èƒ½ä¼˜åŒ–
- å¹¶è¡Œå¤„ç†æ–‡ä»¶
- ç¼“å­˜æœºåˆ¶
- å¢é‡å¤„ç†

#### Day 5: æ–‡æ¡£å’Œç¤ºä¾‹
- API æ–‡æ¡£
- ä½¿ç”¨æŒ‡å—
- ç¤ºä¾‹é¡¹ç›®

---

## å››ã€å¼€å‘ä¼˜å…ˆçº§

### é«˜ä¼˜å…ˆçº§ (MVP)

å¿…é¡»å®Œæˆçš„æ ¸å¿ƒåŠŸèƒ½:

1. âœ… **i18n-extract** (æœ€æ ¸å¿ƒ)
   - æ‰«æä»£ç 
   - ç”Ÿæˆ key
   - è¾“å‡ºæ¸…å•

2. âœ… **i18n-apply** (æ ¸å¿ƒ)
   - ä»£ç æ›¿æ¢
   - ç”Ÿæˆ t() è°ƒç”¨

3. âœ… **i18n-build** (æ ¸å¿ƒ)
   - æ„å»ºæ—¶åˆå¹¶
   - è¾“å‡ºè¯­è¨€åŒ…

### ä¸­ä¼˜å…ˆçº§

æå‡è´¨é‡å’Œç»´æŠ¤æ€§:

4. âš ï¸ **i18n-check**
   - ä¸€è‡´æ€§æ£€æŸ¥
   - CI é›†æˆ

5. âš ï¸ **i18n-sync**
   - åŒæ­¥ key
   - è‡ªåŠ¨ä¿®å¤

### ä½ä¼˜å…ˆçº§

æ”¹å–„ç”¨æˆ·ä½“éªŒ:

6. ğŸ’¡ **i18n-review** (äº¤äº’å¼å®¡æ ¸)
7. ğŸ’¡ **VSCode æ’ä»¶**
8. ğŸ’¡ **åœ¨çº¿ç®¡ç†å¹³å°**

---

## äº”ã€æŠ€æœ¯éš¾ç‚¹ä¸è§£å†³æ–¹æ¡ˆ

### éš¾ç‚¹ 1: ä¸Šä¸‹æ–‡ä¿¡æ¯æ”¶é›†ä¸è¶³

**é—®é¢˜**: AST éå†æ—¶,éš¾ä»¥è·å–å®Œæ•´çš„ä¸Šä¸‹æ–‡ä¿¡æ¯

**è§£å†³æ–¹æ¡ˆ**:
1. å¢å¼º visitor,æ”¶é›†æ›´å¤šä¿¡æ¯:
   - çˆ¶èŠ‚ç‚¹é“¾
   - ä½œç”¨åŸŸé“¾
   - æ–‡ä»¶è·¯å¾„

2. ä½¿ç”¨ Babel çš„ scope å’Œ binding API:
```typescript
traverse(ast, {
  StringLiteral(path) {
    // è·å–ä½œç”¨åŸŸä¿¡æ¯
    const scope = path.scope;
    const binding = scope.getBinding('variableName');
    
    // è·å–çˆ¶èŠ‚ç‚¹é“¾
    const parents = [];
    let current = path;
    while (current.parent) {
      parents.push(current.parent);
      current = current.parentPath;
    }
  }
});
```

### éš¾ç‚¹ 2: Key å‘½åå†²çª

**é—®é¢˜**: ä¸åŒæ¨¡å—å¯èƒ½ç”Ÿæˆç›¸åŒçš„ key

**è§£å†³æ–¹æ¡ˆ**:
1. å®Œæ•´ key åŒ…å«æ¨¡å—å‰ç¼€: `drama.list.title`
2. å†²çªæ—¶æ·»åŠ æ•°å­—åç¼€: `btn_submit2`
3. æä¾›äººå·¥å®¡æ ¸æœºåˆ¶

### éš¾ç‚¹ 3: å¤æ‚å­—ç¬¦ä¸²å¤„ç†

**é—®é¢˜**: æ¨¡æ¿å­—ç¬¦ä¸²ã€å­—ç¬¦ä¸²æ‹¼æ¥éš¾ä»¥å¤„ç†

**è§£å†³æ–¹æ¡ˆ**:
1. è¯†åˆ«ç®€å•åœºæ™¯,è‡ªåŠ¨å¤„ç†
2. å¤æ‚åœºæ™¯æ ‡è®°ä¸º `review`,äººå·¥å¤„ç†
3. æä¾›æ ‡è®°ç³»ç»Ÿ,å…è®¸å¼€å‘è€…ä¸»åŠ¨æ ‡è®°
4. å»ºè®®äººå·¥é‡æ„ä¸ºæ ‡å‡†æ ¼å¼

### éš¾ç‚¹ 4: ä¿æŒä»£ç æ ¼å¼

**é—®é¢˜**: AST æ›¿æ¢å,ä»£ç æ ¼å¼å¯èƒ½æ”¹å˜

**è§£å†³æ–¹æ¡ˆ**:
1. ä½¿ç”¨ @babel/generator çš„ retainLines é€‰é¡¹
2. é›†æˆ Prettier æ ¼å¼åŒ–
3. åªæ›¿æ¢å¿…è¦çš„èŠ‚ç‚¹,ä¿æŒå…¶ä»–ä»£ç ä¸å˜

### éš¾ç‚¹ 5: å¤šæ¡†æ¶æ”¯æŒ

**é—®é¢˜**: Reactã€Vue è¯­æ³•ä¸åŒ

**è§£å†³æ–¹æ¡ˆ**:
1. ä½¿ç”¨ @babel/parser çš„ plugins é…ç½®:
```typescript
const ast = parse(code, {
  sourceType: 'module',
  plugins: [
    'jsx',
    'typescript',
    'decorators-legacy',
  ]
});
```

2. Vue SFC ä½¿ç”¨ @vue/compiler-sfc:
```typescript
import { parse } from '@vue/compiler-sfc';

const { descriptor } = parse(vueCode);
// å¤„ç† template, script, style
```

---

## å…­ã€æµ‹è¯•ç­–ç•¥

### å•å…ƒæµ‹è¯•

æ¯ä¸ªæ¨¡å—ç‹¬ç«‹æµ‹è¯•:

```typescript
// i18n-extract/src/__tests__/scanner.test.ts
describe('Scanner', () => {
  it('should extract JSX text', () => {
    const code = '<div>ä½ å¥½</div>';
    const result = scanner.scan(code);
    expect(result).toHaveLength(1);
    expect(result[0].text).toBe('ä½ å¥½');
  });
  
  it('should collect context', () => {
    const code = '<button>æäº¤</button>';
    const result = scanner.scan(code);
    expect(result[0].context.parentTag).toBe('button');
  });
});
```

### é›†æˆæµ‹è¯•

æµ‹è¯•å®Œæ•´æµç¨‹:

```typescript
describe('Full Pipeline', () => {
  it('should extract â†’ apply â†’ build', async () => {
    // 1. æå–
    await extract('./test-project');
    expect(fs.existsSync('extract-manifest.json')).toBe(true);
    
    // 2. åº”ç”¨
    await apply();
    const code = fs.readFileSync('./test-project/src/App.tsx', 'utf-8');
    expect(code).toContain("t('common.buttons.btn_submit')");
    
    // 3. æ„å»º
    await build();
    const zhCN = require('./dist/locales/zh-CN.json');
    expect(zhCN['common.buttons.btn_submit']).toBe('æäº¤');
  });
});
```

### E2E æµ‹è¯•

æµ‹è¯•çœŸå®é¡¹ç›®:

1. å‡†å¤‡æµ‹è¯•é¡¹ç›® (React + TypeScript)
2. è¿è¡Œå®Œæ•´å·¥å…·é“¾
3. éªŒè¯ç»“æœ
4. è¿è¡Œé¡¹ç›®,æ£€æŸ¥è¿è¡Œæ—¶

---

## ä¸ƒã€æ–‡æ¡£è®¡åˆ’

### ç”¨æˆ·æ–‡æ¡£

1. **å¿«é€Ÿå¼€å§‹**
   - 5 åˆ†é’Ÿä¸Šæ‰‹
   - åŸºç¡€é…ç½®
   - å¸¸è§ç”¨æ³•

2. **é…ç½®æŒ‡å—**
   - é…ç½®æ–‡ä»¶ç»“æ„
   - æ‰€æœ‰é…ç½®é¡¹è¯´æ˜
   - æœ€ä½³å®è·µ

3. **å·¥å…·ä½¿ç”¨**
   - i18n-extract è¯¦è§£
   - i18n-apply è¯¦è§£
   - å…¶ä»–å·¥å…·è¯´æ˜

4. **é«˜çº§ç”¨æ³•**
   - æ ‡è®°ç³»ç»Ÿ
   - è‡ªå®šä¹‰è§„åˆ™
   - CI/CD é›†æˆ

### å¼€å‘æ–‡æ¡£

1. **æ¶æ„è®¾è®¡**
   - æ•´ä½“æ¶æ„
   - æ¨¡å—åˆ’åˆ†
   - æ•°æ®æµ

2. **API æ–‡æ¡£**
   - æ ¸å¿ƒ API
   - å·¥å…·å‡½æ•°
   - ç±»å‹å®šä¹‰

3. **è´¡çŒ®æŒ‡å—**
   - å¼€å‘ç¯å¢ƒæ­å»º
   - ä»£ç è§„èŒƒ
   - æäº¤æµç¨‹

---

## å…«ã€å‘å¸ƒè®¡åˆ’

### v1.0.0-alpha (Week 4)

**åŠŸèƒ½**:
- âœ… i18n-extract (åŸºç¡€åŠŸèƒ½)
- âœ… i18n-apply (åŸºç¡€åŠŸèƒ½)
- âœ… i18n-build

**äº¤ä»˜**:
- npm åŒ…å‘å¸ƒ
- åŸºç¡€æ–‡æ¡£
- ç¤ºä¾‹é¡¹ç›®

### v1.0.0-beta (Week 6)

**æ–°å¢**:
- âœ… i18n-check
- âœ… i18n-sync
- âœ… CLI å·¥å…·

**æ”¹è¿›**:
- æ€§èƒ½ä¼˜åŒ–
- Bug ä¿®å¤
- æ–‡æ¡£å®Œå–„

### v1.0.0 (Week 8)

**æ–°å¢**:
- âœ… i18n-review (äº¤äº’å¼å®¡æ ¸)
- âœ… å®Œæ•´æµ‹è¯•
- âœ… å®Œæ•´æ–‡æ¡£

**è´¨é‡**:
- æµ‹è¯•è¦†ç›–ç‡ >80%
- æ‰€æœ‰å·²çŸ¥ bug ä¿®å¤
- ç”Ÿäº§ç¯å¢ƒå¯ç”¨

### v1.1.0 (Week 10+)

**å¢å¼º**:
- ğŸ’¡ VSCode æ’ä»¶
- ğŸ’¡ æ€§èƒ½ä¼˜åŒ–
- ğŸ’¡ æ›´å¤šæ¡†æ¶æ”¯æŒ

---

## ä¹ã€æˆåŠŸæ ‡å‡†

### æŠ€æœ¯æŒ‡æ ‡

- âœ… è‡ªåŠ¨å¤„ç†ç‡ >60%
- âœ… Key ç”Ÿæˆå‡†ç¡®ç‡ >85%
- âœ… å¤„ç†é€Ÿåº¦: 1000 æ–‡ä»¶/åˆ†é’Ÿ
- âœ… æµ‹è¯•è¦†ç›–ç‡ >80%

### ç”¨æˆ·ä½“éªŒ

- âœ… 5 åˆ†é’Ÿå†…ä¸Šæ‰‹
- âœ… æ¸…æ™°çš„é”™è¯¯æç¤º
- âœ… å®Œå–„çš„æ–‡æ¡£
- âœ… å‹å¥½çš„å‘½ä»¤è¡Œç•Œé¢

### ä¸šåŠ¡ä»·å€¼

- âœ… å‡å°‘äººå·¥å·¥ä½œé‡ 70%+
- âœ… æé«˜ç¿»è¯‘è´¨é‡
- âœ… é™ä½ç»´æŠ¤æˆæœ¬
- âœ… æ”¯æŒå¿«é€Ÿè¿­ä»£

---

## åã€é£é™©ä¸åº”å¯¹

### é£é™© 1: æŠ€æœ¯å¤æ‚åº¦è¶…é¢„æœŸ

**åº”å¯¹**:
- å‚è€ƒç°æœ‰å·¥å…· (i18next-scanner, kiwi)
- é™ä½åˆæœŸç›®æ ‡,å…ˆåš MVP
- åŠæ—¶è°ƒæ•´æ–¹æ¡ˆ

### é£é™© 2: è¾¹ç•Œåœºæ™¯å¤„ç†å›°éš¾

**åº”å¯¹**:
- ä¼˜å…ˆå¤„ç†å¸¸è§åœºæ™¯
- è¾¹ç•Œåœºæ™¯æ ‡è®°ä¸ºæ‰‹åŠ¨å¤„ç†
- æŒç»­è¿­ä»£ä¼˜åŒ–

### é£é™© 3: å¤šæ¡†æ¶å…¼å®¹æ€§

**åº”å¯¹**:
- å…ˆæ”¯æŒ React
- é€æ­¥æ‰©å±• Vue ç­‰
- è®¾è®¡è‰¯å¥½çš„æ‰©å±•æ¥å£

### é£é™© 4: ç”¨æˆ·å­¦ä¹ æˆæœ¬

**åº”å¯¹**:
- æä¾›è¯¦ç»†æ–‡æ¡£
- å½•åˆ¶è§†é¢‘æ•™ç¨‹
- å»ºç«‹ç¤¾åŒºæ”¯æŒ

---

## åä¸€ã€åç»­è§„åˆ’

### Phase 2 (v2.0)

**VSCode æ’ä»¶**:
- ä»£ç æç¤º
- Key è·³è½¬
- å®æ—¶é¢„è§ˆ

**æ€§èƒ½ä¼˜åŒ–**:
- å¢é‡å¤„ç†
- ç¼“å­˜æœºåˆ¶
- å¹¶è¡Œå¤„ç†

### Phase 3 (v3.0)

**åœ¨çº¿ç®¡ç†å¹³å°**:
- ç¿»è¯‘ç®¡ç†
- å›¢é˜Ÿåä½œ
- ç‰ˆæœ¬æ§åˆ¶

**AI å¢å¼º**:
- AI è¾…åŠ©å‘½å
- AI ç¿»è¯‘å»ºè®®
- ä¸Šä¸‹æ–‡ç†è§£

---

## åäºŒã€æ€»ç»“

### æ ¸å¿ƒç†å¿µ

1. **è‡ªåŠ¨åŒ–ä¼˜å…ˆ**: èƒ½è‡ªåŠ¨å¤„ç†çš„åœºæ™¯,å°½é‡è‡ªåŠ¨åŒ–
2. **äººå·¥å®¡æ ¸è¡¥å……**: å¤æ‚åœºæ™¯,æä¾›å®¡æ ¸æœºåˆ¶
3. **æ¸è¿›å¼å®æ–½**: ä¸è¦æ±‚ä¸€æ¬¡å®Œæˆ,æŒç»­ä¼˜åŒ–
4. **è´¨é‡ä¿è¯**: å¤šé‡æ£€æŸ¥,ç¡®ä¿ä¸€è‡´æ€§
5. **æ˜“äºä½¿ç”¨**: ç®€å•çš„ CLI,æ¸…æ™°çš„æ–‡æ¡£

### ä¸‹ä¸€æ­¥è¡ŒåŠ¨

**ç«‹å³å¼€å§‹** (æœ¬å‘¨):
1. [ ] æ­å»º monorepo é¡¹ç›®
2. [ ] é…ç½®å¼€å‘ç¯å¢ƒ
3. [ ] å¼€å§‹å®ç° i18n-extract

**æœ¬æœˆç›®æ ‡**:
1. [ ] å®Œæˆ i18n-extract
2. [ ] å®Œæˆ i18n-apply
3. [ ] å®Œæˆ i18n-build
4. [ ] å‘å¸ƒ v1.0.0-alpha

**æœ¬å­£åº¦ç›®æ ‡**:
1. [ ] å®Œæˆæ‰€æœ‰æ ¸å¿ƒå·¥å…·
2. [ ] å®Œæˆæµ‹è¯•å’Œæ–‡æ¡£
3. [ ] å‘å¸ƒ v1.0.0
4. [ ] åœ¨å®é™…é¡¹ç›®ä¸­åº”ç”¨

---

**æ–‡æ¡£ç»´æŠ¤**: æœ¬æ–‡æ¡£å°†éšç€å¼€å‘è¿›åº¦æŒç»­æ›´æ–°  
**æœ€åæ›´æ–°**: 2025-11-13  
**ç»´æŠ¤è€…**: å›½é™…åŒ–å·¥ä½œç»„

